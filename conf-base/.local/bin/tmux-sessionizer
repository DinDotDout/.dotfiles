#!/usr/bin/env bash
if [[ $# -eq 1 && $1 == "--no-database" ]]; then
    SELECTED=$(find ~/Documents/projects ~/Documents/projects/tests ~/Documents/projects/graphics ~/ -mindepth 1 -maxdepth 1 -type d | fzf --reverse)
else
    # NOTE: tiebreak preserves zoxide order.
    SELECTED=$(zoxide query -l | fzf --tiebreak=index --reverse)
fi

if [ -z "$SELECTED" ]; then
    exit 0
fi

SESSION_NAME=$(basename "$SELECTED" | tr . _)

# Create session.
if ! tmux has-session -t=$SESSION_NAME 2>/dev/null; then
    tmux new-session -ds $SESSION_NAME -c $SELECTED
fi

zoxide add $SELECTED # Update zoxide database.
if [[ -z $TMUX ]]; then
    tmux attach -t $SESSION_NAME
else
    tmux switch-client -t $SESSION_NAME
fi
